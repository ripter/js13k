<!doctype html><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content=yes name=apple-mobile-web-app-capable><meta content=$pay.stronghold.co/1a136a73a59d52b475b94e49fdea69dae89 name=monetization><title>JS13KGame 2019: Theme Back!</title><script src=https://aframe.io/releases/0.9.2/aframe.min.js></script><style>body,html{width:100%;height:100%;margin:0;padding:0}body{background-color:#0074d9}</style><body><a-scene><a-entity id=player><a-entity id=camera position="0 1.6 0" camera look-controls wasd-controls></a-entity><a-entity id=leftHand position="0 1 -0.25"><a-cone color=#FFDC00 height=0.25 radius-bottom=0.02 radius-top=0.1></a-cone></a-entity></a-entity></a-scene><script>(function(){'use strict';function a(a,c){b(a,c)}function b(a,b){Object.keys(b).forEach(c=>{const d=b[c];a.setAttribute(c,d)})}const c={HEART:["moveTo",[.528,.097],"bezierCurveTo",[.58,.032,.644,0,.722,0],"bezierCurveTo",[.798,0,.864,.032,.919,.097],"lineTo",[.922,.097],"bezierCurveTo",[.974,.161,1,.236,1,.322],"bezierCurveTo",[1,.395,.982,.458,.944,.512],"lineTo",[.919,.547],"lineTo",[.539,.981],"lineTo",[.5,1],"bezierCurveTo",[.485,1,.472,.994,.461,.981],"lineTo",[.081,.547],"lineTo",[.056,.512],"bezierCurveTo",[.019,.458,0,.395,0,.322],"bezierCurveTo",[0,.236,.027,.161,.081,.097],"bezierCurveTo",[.136,.032,.202,0,.278,0],"bezierCurveTo",[.356,0,.42,.032,.472,.097],"lineTo",[.5,.134],"lineTo",[.528,.097]],CLOUD:["moveTo",[.625,1.25],"lineTo",[2.1875,1.25],"bezierCurveTo",[2.5,1.25,2.5,.625,2.1875,.625],"bezierCurveTo",[2.1875,.125,1.375,.125,1.3125,.5],"bezierCurveTo",[1.3125,.5,.9375,.3125,.75,.75],"bezierCurveTo",[.75,.75,.3125,.875,.625,1.25]],LIGHTNING:["moveTo",[2.4,2],"lineTo",[2.9,2],"lineTo",[2.7,2.4],"lineTo",[3.1,2.4],"lineTo",[2.3,3.3],"lineTo",[2.5,2.8],"lineTo",[2,2.8]]};AFRAME.registerGeometry("extrudeShape",{schema:{icon:{default:"HEART"}},init(a){const b=c[a.icon],d=new THREE.Shape;for(let c=0;c<b.length;c+=2){const a=b[c],e=b[c+1];d[a].apply(d,e)}const e=new THREE.ExtrudeGeometry(d,{depth:.15,bevelEnabled:!1});e.rotateX(3.14159),this.geometry=e}}),AFRAME.registerComponent("orbit",{schema:{startTheta:{default:0},deltaTheta:{type:"number"},radius:{type:"number"}},init:function(){this.theta=this.data.startTheta},tick(a,b){const{deltaTheta:c,radius:d}=this.data,{position:e}=this.el.object3D,{theta:f}=this,g=d*Math.cos(f),h=d*Math.sin(f);this.theta+=c,e.set(g,e.y,h)}});const d=["#001f3f","#7FDBFF","#3D9970","#01FF70","#FF851B","#85144b","#B10DC9"];AFRAME.registerComponent("selectable",{schema:{},init:function(){this.system=this.el.sceneEl.systems.game,this.lastIndex=-1,["click","triggerdown"].forEach(a=>{this.el.addEventListener(a,this)})},handleEvent(a){const{lastIndex:b}=this;let c=b;for(;c===b;)c=THREE.Math.randInt(0,d.length-1);this.el.setAttribute("material","color",d[c]),this.lastIndex=c,this.system.setSelected(this.el)}}),AFRAME.registerComponent("float-to",{schema:{target:{type:"selector"},position:{type:"vec3"},speed:{type:"number"}},init(){this.velocity=new THREE.Vector3(0,0,.01)},tick(a,b){const c=this.data.target.object3D.position;console.log("targetPosition",c);const d=this.el.object3D.position.distanceToSquared(c);0>=(0|d)&&(console.log("self-remove float-to",d),this.el.removeAttribute("float-to")),this.el.object3D.lookAt(c),this.el.object3D.translateZ(.01)}});class e{constructor(){const b=this.elCamera=document.querySelector("#camera"),c=this.elLeftHand=document.querySelector("#leftHand");this.el=document.createElement("a-entity"),b.appendChild(this.el),a(this.el,f),window.addEventListener("gamepadconnected",()=>{this.el.remove(),this.el=document.createElement("a-entity"),a(this.el,g),c.appendChild(this.el)})}}const f={cursor:{fuse:!0,fuseTimeout:500},position:{x:0,y:0,z:-1},geometry:{primitive:"ring",radiusInner:.02,radiusOuter:.03},material:{color:"black",shader:"flat"},raycaster:{objects:"[selectable]"}},g={"laser-controls":{model:!1},raycaster:{objects:"[cursor-listener]"},line:{color:"red",opacity:.75}};class h{constructor(){this.scene=document.querySelector("a-scene"),this.el=document.createElement("a-entity"),a(this.el,i),this.scene.appendChild(this.el)}update(){}}const i={geometry:{primitive:"plane",width:10,height:10},rotation:{x:-90,y:0,z:0}};class j{constructor(b={},c="HEART"){var d=Math.PI;this.scene=document.querySelector("a-scene"),this.el=document.createElement("a-entity"),this.state={class:c,selectable:{},orbit:{radius:THREE.Math.randInt(3,6),startTheta:THREE.Math.randFloat(0,2*d),deltaTheta:(0===THREE.Math.randInt(0,1)?1:-1)*(2*d/Math.pow(10,THREE.Math.randFloat(3,4)))},position:{x:b.x||0,y:b.y||0,z:b.z||0},rotation:{x:0,y:0,z:0},geometry:{primitive:"extrudeShape",icon:c},material:{opacity:1,shader:"standard"},visible:!0},a(this.el,this.state),this.scene.appendChild(this.el)}update(a,b){}}const k=Object.keys(c);AFRAME.registerSystem("game",{schema:{},init(){this.controller=new e,this.selected={entity:null,isPull:!0,orbitPosition:new THREE.Vector3(0,0,0)},this.floor=new h,this.startGame()},tick(a,b){this.entities.forEach(c=>c.update(a,b))},setSelected(a){a===this.selected.entity||(console.log("setSelected",a),this.selected.entity&&this.clearSelected(),this.selected.isPull=!0,this.selected.entity=a,a.object3D.getWorldDirection(this.selected.orbitPosition),this.selected.orbitAttribute=a.getAttribute("obit"),window.selectedEntity=a,a.removeAttribute("orbit"),a.setAttribute("float-to",{target:"#leftHand",speed:1}))},clearSelected(){return console.log("clearSelected",this.selected.entity),this.selected.entity.removeAttribute("float-to"),void(this.selected.entity=null)},startGame(){const{entities:a=[]}=this;for(let b=0;b<20;b++){const b=k[THREE.Math.randInt(0,k.length)];a.push(new j({x:0,y:THREE.Math.randInt(2,4),z:0},b))}this.entities=a}})})();</script>