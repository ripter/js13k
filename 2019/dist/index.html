<!doctype html><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content=yes name=apple-mobile-web-app-capable><meta content=$pay.stronghold.co/1a136a73a59d52b475b94e49fdea69dae89 name=monetization><title>JS13KGame 2019: Theme Back!</title><script src=https://aframe.io/releases/0.9.2/aframe.min.js></script><style>body,html{width:100%;height:100%;margin:0;padding:0}body{background-color:#0074d9}</style><body><a-scene><a-entity id=player><a-entity id=camera position="0 1.6 0" camera look-controls wasd-controls></a-entity><a-entity id=leftHand position="0 1 -0.25"><a-cone color=#FFDC00 height=0.25 radius-bottom=0.02 radius-top=0.1></a-cone></a-entity></a-entity></a-scene><script>(function(){'use strict';function a(a,c){b(a,c)}function b(a,b){Object.keys(b).forEach(c=>{const d=b[c];a.setAttribute(c,d)})}const c={HEART:["moveTo",[.528,.097],"bezierCurveTo",[.58,.032,.644,0,.722,0],"bezierCurveTo",[.798,0,.864,.032,.919,.097],"lineTo",[.922,.097],"bezierCurveTo",[.974,.161,1,.236,1,.322],"bezierCurveTo",[1,.395,.982,.458,.944,.512],"lineTo",[.919,.547],"lineTo",[.539,.981],"lineTo",[.5,1],"bezierCurveTo",[.485,1,.472,.994,.461,.981],"lineTo",[.081,.547],"lineTo",[.056,.512],"bezierCurveTo",[.019,.458,0,.395,0,.322],"bezierCurveTo",[0,.236,.027,.161,.081,.097],"bezierCurveTo",[.136,.032,.202,0,.278,0],"bezierCurveTo",[.356,0,.42,.032,.472,.097],"lineTo",[.5,.134],"lineTo",[.528,.097]],PENCIL:["moveTo",[.333,.946],"lineTo",[.054,1],"lineTo",[0,.946],"lineTo",[.054,.667],"lineTo",[.721,0],"lineTo",[1,.277],"lineTo",[.333,.946]],BRUSH:["moveTo",[.901,0],"lineTo",[1,.098],"bezierCurveTo",[.678,.664,.427,.905,.248,.823],"lineTo",[.202,.774],"bezierCurveTo",[.139,.567,.372,.309,.901,0],"moveTo",[.097,.764],"lineTo",[.1,.761],"bezierCurveTo",[.119,.741,.141,.731,.168,.731],"bezierCurveTo",[.195,.73,.219,.74,.239,.76],"bezierCurveTo",[.258,.78,.267,.805,.267,.834],"bezierCurveTo",[.267,.863,.258,.887,.239,.907],"lineTo",[.236,.91],"bezierCurveTo",[.195,.953,.154,.983,.11,1],"lineTo",[.016,.997],"bezierCurveTo",[-.004,.977,-.005,.944,.012,.897],"bezierCurveTo",[.028,.851,.056,.807,.097,.764]],SOMETHING:["moveTo",[.857,.45],"bezierCurveTo",[.857,.464,.85,.476,.836,.486],"bezierCurveTo",[.821,.495,.805,.5,.786,.5],"lineTo",[.7,.5],"lineTo",[.691,.506],"bezierCurveTo",[.751,.524,.805,.549,.854,.581],"bezierCurveTo",[.951,.647,1,.727,1,.821],"bezierCurveTo",[1,.871,.951,.913,.854,.948],"bezierCurveTo",[.757,.983,.639,1,.5,1],"bezierCurveTo",[.362,1,.244,.983,.146,.948],"bezierCurveTo",[.05,.913,.001,.871,0,.821],"bezierCurveTo",[0,.727,.049,.647,.146,.581],"bezierCurveTo",[.195,.549,.249,.524,.309,.506],"lineTo",[.3,.5],"lineTo",[.214,.5],"bezierCurveTo",[.194,.5,.177,.495,.162,.486],"bezierCurveTo",[.149,.476,.143,.464,.143,.45],"lineTo",[.143,.051],"bezierCurveTo",[.143,.037,.149,.025,.162,.015],"bezierCurveTo",[.177,.005,.194,0,.214,0],"lineTo",[.786,0],"bezierCurveTo",[.805,0,.821,.005,.836,.015],"bezierCurveTo",[.85,.025,.857,.037,.857,.05],"lineTo",[.857,.45]],KEY:["moveTo",[.867,.098],"bezierCurveTo",[.868,.119,.865,.137,.857,.153],"lineTo",[.982,.296],"bezierCurveTo",[1.006,.324,1.006,.352,.982,.38],"lineTo",[.954,.411],"lineTo",[.941,.42],"lineTo",[.929,.413],"lineTo",[.91,.391],"lineTo",[.844,.47],"lineTo",[.863,.49],"lineTo",[.867,.503],"lineTo",[.861,.518],"lineTo",[.835,.55],"bezierCurveTo",[.809,.579,.784,.579,.76,.55],"lineTo",[.635,.406],"lineTo",[.516,.547],"bezierCurveTo",[.54,.592,.557,.641,.566,.693],"lineTo",[.563,.695],"bezierCurveTo",[.578,.791,.559,.867,.505,.924],"bezierCurveTo",[.455,.987,.387,1.011,.303,.995],"bezierCurveTo",[.236,.982,.175,.946,.12,.889],"lineTo",[.109,.875],"bezierCurveTo",[.051,.811,.016,.738,.004,.657],"lineTo",[.004,.655],"bezierCurveTo",[-.001,.624,-.001,.595,.003,.57],"bezierCurveTo",[.006,.51,.026,.46,.063,.42],"bezierCurveTo",[.099,.377,.143,.354,.194,.348],"lineTo",[.266,.351],"lineTo",[.27,.351],"bezierCurveTo",[.313,.36,.354,.379,.392,.406],"lineTo",[.727,.021],"bezierCurveTo",[.74,.004,.759,-.003,.783,.001],"bezierCurveTo",[.805,.004,.824,.015,.839,.034],"lineTo",[.852,.048],"bezierCurveTo",[.862,.062,.867,.079,.867,.098]],DIAMOND:["moveTo",[.98,.234],"bezierCurveTo",[.992,.246,.999,.263,1,.284],"bezierCurveTo",[1.001,.302,.996,.32,.986,.336],"lineTo",[.547,.976],"lineTo",[.518,1],"lineTo",[.483,1],"bezierCurveTo",[.471,.995,.462,.987,.454,.976],"lineTo",[.015,.336],"bezierCurveTo",[.004,.32,-.001,.302,0,.284],"bezierCurveTo",[.001,.265,.007,.249,.018,.236],"lineTo",[.194,.022],"bezierCurveTo",[.206,.007,.22,0,.236,0],"lineTo",[.75,0],"bezierCurveTo",[.766,0,.78,.007,.791,.02],"lineTo",[.98,.234]],JOYSTICK:["moveTo",[.5,0],"bezierCurveTo",[.634,0,.749,.03,.843,.089],"bezierCurveTo",[.95,.155,1.002,.236,1,.334],"bezierCurveTo",[1.003,.43,.951,.511,.843,.577],"lineTo",[.845,.577],"bezierCurveTo",[.799,.606,.749,.628,.695,.643],"lineTo",[.695,.889],"bezierCurveTo",[.695,.92,.684,.947,.663,.969],"lineTo",[.66,.971],"bezierCurveTo",[.638,.99,.612,1,.584,1],"lineTo",[.417,1],"bezierCurveTo",[.386,1,.36,.99,.339,.971],"lineTo",[.336,.967],"bezierCurveTo",[.316,.945,.306,.919,.306,.889],"lineTo",[.306,.643],"bezierCurveTo",[.251,.628,.201,.606,.156,.577],"bezierCurveTo",[.05,.511,-.002,.43,0,.334],"bezierCurveTo",[-.002,.236,.05,.155,.156,.089],"bezierCurveTo",[.251,.03,.366,0,.5,0]],DPAD:["moveTo",[1,.333],"lineTo",[1,.667],"bezierCurveTo",[1,.681,.994,.694,.983,.706],"bezierCurveTo",[.972,.717,.959,.722,.944,.722],"lineTo",[.722,.722],"lineTo",[.722,.944],"bezierCurveTo",[.722,.96,.717,.974,.706,.985],"bezierCurveTo",[.694,.995,.681,1,.667,1],"lineTo",[.333,1],"bezierCurveTo",[.318,1,.304,.995,.293,.985],"bezierCurveTo",[.283,.974,.278,.96,.278,.944],"lineTo",[.278,.722],"lineTo",[.056,.722],"bezierCurveTo",[.04,.722,.026,.717,.015,.706],"bezierCurveTo",[.005,.694,0,.681,0,.667],"lineTo",[0,.333],"bezierCurveTo",[0,.318,.005,.304,.015,.293],"bezierCurveTo",[.026,.283,.04,.278,.056,.278],"lineTo",[.278,.278],"lineTo",[.278,.057],"bezierCurveTo",[.278,.041,.283,.028,.293,.017],"bezierCurveTo",[.304,.006,.318,0,.333,0],"lineTo",[.667,0],"bezierCurveTo",[.681,0,.694,.006,.706,.017],"bezierCurveTo",[.717,.028,.722,.041,.722,.056],"lineTo",[.722,.278],"lineTo",[.943,.278],"bezierCurveTo",[.959,.278,.972,.283,.983,.293],"bezierCurveTo",[.994,.304,1,.318,1,.333]]};AFRAME.registerGeometry("extrudeShape",{schema:{icon:{default:"HEART"}},init(a){const b=c[a.icon],d=new THREE.Shape;for(let c=0;c<b.length;c+=2){const a=b[c],e=b[c+1];d[a].apply(d,e)}const e=new THREE.ExtrudeGeometry(d,{depth:.15,bevelEnabled:!1});e.rotateX(3.14159),this.geometry=e}}),AFRAME.registerComponent("orbit",{schema:{startTheta:{default:0},deltaTheta:{type:"number"},radius:{type:"number"}},init:function(){this.theta=this.data.startTheta},tick(a,b){const{deltaTheta:c,radius:d}=this.data,{position:e}=this.el.object3D,{theta:f}=this,g=d*Math.cos(f),h=d*Math.sin(f);this.theta+=c,e.set(g,e.y,h)}});const d=["#001f3f","#7FDBFF","#3D9970","#01FF70","#FF851B","#85144b","#B10DC9"];AFRAME.registerComponent("selectable",{schema:{},init:function(){this.system=this.el.sceneEl.systems.game,this.lastIndex=-1,["click","triggerdown"].forEach(a=>{this.el.addEventListener(a,this)})},handleEvent(a){const{lastIndex:b}=this;let c=b;for(;c===b;)c=THREE.Math.randInt(0,d.length-1);this.el.setAttribute("material","color",d[c]),this.lastIndex=c,this.system.setSelected(this.el)}}),AFRAME.registerComponent("float-to",{schema:{targetPosition:{type:"vec3"},speed:{type:"number"}},init(){this.velocity=new THREE.Vector3(0,0,.01)},tick(a,b){const{targetPosition:c,speed:d}=this.data;console.group("float-to.update"),console.log("this.el.object3D.position",this.el.object3D.position),console.log("targetPosition",c);const e=this.el.object3D.position.distanceToSquared(c);console.log("distance",e),0>=(0|e)&&(console.log("self-remove float-to",e),this.el.removeAttribute("float-to")),this.el.object3D.lookAt(c),this.el.object3D.translateZ(d),console.groupEnd()}});class e{constructor(){const b=this.elCamera=document.querySelector("#camera"),c=this.elLeftHand=document.querySelector("#leftHand");this.el=document.createElement("a-entity"),b.appendChild(this.el),a(this.el,f),window.addEventListener("gamepadconnected",()=>{this.el.remove(),this.el=document.createElement("a-entity"),a(this.el,g),c.appendChild(this.el)})}}const f={cursor:{fuse:!0,fuseTimeout:500},position:{x:0,y:0,z:-1},geometry:{primitive:"ring",radiusInner:.02,radiusOuter:.03},material:{color:"black",shader:"flat"},raycaster:{objects:"[selectable]"}},g={"laser-controls":{model:!1},raycaster:{objects:"[cursor-listener]"},line:{color:"red",opacity:.75}};class h{constructor(){this.scene=document.querySelector("a-scene"),this.el=document.createElement("a-entity"),a(this.el,i),this.scene.appendChild(this.el)}update(){}}const i={geometry:{primitive:"plane",width:10,height:10},rotation:{x:-90,y:0,z:0}};class j{constructor(b={},c="HEART"){var d=Math.PI;this.scene=document.querySelector("a-scene"),this.el=document.createElement("a-entity"),this.state={class:c,selectable:{},orbit:{radius:THREE.Math.randInt(3,6),startTheta:THREE.Math.randFloat(0,2*d),deltaTheta:(0===THREE.Math.randInt(0,1)?1:-1)*(2*d/Math.pow(10,THREE.Math.randFloat(3,4)))},position:{x:b.x||0,y:b.y||0,z:b.z||0},rotation:{x:0,y:0,z:0},geometry:{primitive:"extrudeShape",icon:c},material:{opacity:1,shader:"standard"},visible:!0},a(this.el,this.state),this.scene.appendChild(this.el)}update(a,b){}}const k=Object.keys(c);AFRAME.registerSystem("game",{schema:{},init(){this.controller=new e,this.elLeftHand=document.querySelector("#leftHand"),this.selected={entity:null,isPull:!0,orbitPosition:new THREE.Vector3(0,0,0)},this.floor=new h,this.startGame()},tick(a,b){this.entities.forEach(c=>c.update(a,b))},setSelected(a){a===this.selected.entity||(console.log("setSelected",a),this.selected.entity&&this.clearSelected(),this.selected.isPull=!0,this.selected.entity=a,this.selected.orbitPosition.copy(a.object3D.position),this.selected.orbitAttribute=a.getAttribute("obit"),window.selectedEntity=a,a.removeAttribute("orbit"),a.setAttribute("float-to",{targetPosition:this.elLeftHand.object3D.position,speed:.01}))},clearSelected(){return console.log("clearSelected",this.selected.entity),this.selected.entity.setAttribute("float-to",{targetPosition:this.selected.orbitPosition,speed:.05}),void(this.selected.entity=null)},startGame(){const{entities:a=[]}=this;for(let b=0;b<20;b++){const b=k[THREE.Math.randInt(0,k.length)];a.push(new j({x:0,y:THREE.Math.randInt(2,4),z:0},b))}this.entities=a}})})();</script>