<!doctype html><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content=yes name=apple-mobile-web-app-capable><meta content=$pay.stronghold.co/1a136a73a59d52b475b94e49fdea69dae89 name=monetization><title>JS13KGame 2019: Theme "Back"!</title><script src=https://aframe.io/releases/0.9.2/aframe.min.js></script><style>body,html{width:100%;height:100%;margin:0;padding:0}</style><script>(function(){'use strict';function a(a){const b=a=>10>a?"0"+a:""+a,c=b(0|a/1e3/60),d=b(0|a/1e3-60*c);return`${c}:${d}`}function b(){const a={toyboxes:[],toys:[],selectedToy:null,selectedToybox:null},b=[];for(let a,c=0;c<t;c++){for(a=s();b.includes(a);)a=s();b.push(a)}return a.toys=b.reduce((a,b)=>{const c=[,,,,,].fill().map(()=>new m(b));return a.concat(c)},[]),["-1.5 0.1 -1","0 0.1 -1","1.5 0.1 -1"].forEach((c,d)=>{a.toyboxes[d]=new q({shape:b[d],totalToys:u,position:c})}),a}function c(a){return v.hasOwnProperty(a)?v[a]:0}function d(a,b,c,d="triangle"){const e=a.createOscillator(),f=a.createGain();e.type=d,e.connect(f),e.frequency.value=b,f.connect(a.destination),e.start(0),f.gain.exponentialRampToValueAtTime(1e-5,a.currentTime+c)}function*e(a,b=!1){let c=0,d=!0;for(;d;)yield a[c],c+=1,c>=a.length&&(c=0,!b&&(d=!1))}const f={PENCIL:{color:"#FFDC00",cmds:["moveTo",[.333,.946],"lineTo",[.054,1],"lineTo",[0,.946],"lineTo",[.054,.667],"lineTo",[.721,0],"lineTo",[1,.277],"lineTo",[.333,.946]]},BRUSH:{color:"#FF851B",cmds:["moveTo",[.901,0],"lineTo",[1,.098],"bezierCurveTo",[.678,.664,.427,.905,.248,.823],"lineTo",[.202,.774],"bezierCurveTo",[.139,.567,.372,.309,.901,0],"moveTo",[.097,.764],"lineTo",[.1,.761],"bezierCurveTo",[.119,.741,.141,.731,.168,.731],"bezierCurveTo",[.195,.73,.219,.74,.239,.76],"bezierCurveTo",[.258,.78,.267,.805,.267,.834],"bezierCurveTo",[.267,.863,.258,.887,.239,.907],"lineTo",[.236,.91],"bezierCurveTo",[.195,.953,.154,.983,.11,1],"lineTo",[.016,.997],"bezierCurveTo",[-.004,.977,-.005,.944,.012,.897],"bezierCurveTo",[.028,.851,.056,.807,.097,.764]]},DPAD:{color:"#3D9970",cmds:["moveTo",[1,.333],"lineTo",[1,.667],"bezierCurveTo",[1,.681,.994,.694,.983,.706],"bezierCurveTo",[.972,.717,.959,.722,.944,.722],"lineTo",[.722,.722],"lineTo",[.722,.944],"bezierCurveTo",[.722,.96,.717,.974,.706,.985],"bezierCurveTo",[.694,.995,.681,1,.667,1],"lineTo",[.333,1],"bezierCurveTo",[.318,1,.304,.995,.293,.985],"bezierCurveTo",[.283,.974,.278,.96,.278,.944],"lineTo",[.278,.722],"lineTo",[.056,.722],"bezierCurveTo",[.04,.722,.026,.717,.015,.706],"bezierCurveTo",[.005,.694,0,.681,0,.667],"lineTo",[0,.333],"bezierCurveTo",[0,.318,.005,.304,.015,.293],"bezierCurveTo",[.026,.283,.04,.278,.056,.278],"lineTo",[.278,.278],"lineTo",[.278,.057],"bezierCurveTo",[.278,.041,.283,.028,.293,.017],"bezierCurveTo",[.304,.006,.318,0,.333,0],"lineTo",[.667,0],"bezierCurveTo",[.681,0,.694,.006,.706,.017],"bezierCurveTo",[.717,.028,.722,.041,.722,.056],"lineTo",[.722,.278],"lineTo",[.943,.278],"bezierCurveTo",[.959,.278,.972,.283,.983,.293],"bezierCurveTo",[.994,.304,1,.318,1,.333]]},DIAMOND:{color:"#7FDBFF",cmds:["moveTo",[.98,.766],"bezierCurveTo",[.992,.754,.999,.737,1,.716],"bezierCurveTo",[1.001,.698,.996,.68,.986,.664],"lineTo",[.547,.024],"lineTo",[.518,0],"lineTo",[.483,0],"bezierCurveTo",[.471,.005,.462,.013,.454,.024],"lineTo",[.015,.664],"bezierCurveTo",[.004,.68,-.001,.698,0,.716],"bezierCurveTo",[.001,.735,.007,.751,.018,.764],"lineTo",[.194,.978],"bezierCurveTo",[.206,.993,.22,1,.236,1],"lineTo",[.75,1],"bezierCurveTo",[.766,1,.78,.993,.791,.98],"lineTo",[.98,.766]]},CHECKMARK:{color:"#B10DC9",cmds:["moveTo",[.234,.791],"bezierCurveTo",[.246,.79,.257,.784,.266,.774],"lineTo",[.423,.561],"lineTo",[.736,.981],"bezierCurveTo",[.743,.991,.753,.998,.765,1],"bezierCurveTo",[.778,1.001,.789,.997,.798,.988],"lineTo",[.984,.807],"bezierCurveTo",[.994,.799,.999,.788,1,.774],"bezierCurveTo",[1.001,.76,.998,.747,.991,.735],"lineTo",[.459,.016],"lineTo",[.437,0],"lineTo",[.412,0],"lineTo",[.388,.016],"lineTo",[.011,.526],"bezierCurveTo",[.003,.538,-.001,.55,0,.563],"bezierCurveTo",[.001,.579,.007,.59,.016,.599],"lineTo",[.201,.779],"bezierCurveTo",[.211,.789,.222,.793,.234,.791]]},WRENCH:{color:"#AAAAAA",cmds:["moveTo",[.563,.093],"bezierCurveTo",[.62,.145,.653,.21,.663,.286],"lineTo",[.663,.289],"lineTo",[.663,.291],"lineTo",[.663,.336],"lineTo",[.66,.373],"lineTo",[.939,.651],"bezierCurveTo",[.975,.682,.995,.721,.999,.767],"lineTo",[1,.796],"bezierCurveTo",[1,.854,.981,.903,.941,.942],"lineTo",[.939,.943],"bezierCurveTo",[.903,.981,.854,1,.793,1],"bezierCurveTo",[.737,1,.689,.981,.647,.943],"lineTo",[.647,.942],"lineTo",[.461,.756],"lineTo",[.457,.744],"lineTo",[.364,.656],"lineTo",[.282,.651],"lineTo",[.285,.653],"bezierCurveTo",[.212,.641,.15,.611,.099,.561],"lineTo",[.099,.56],"bezierCurveTo",[.025,.482,-.007,.396,.002,.302],"bezierCurveTo",[.003,.271,.009,.241,.021,.211],"bezierCurveTo",[.023,.204,.026,.2,.032,.197],"lineTo",[.047,.193],"lineTo",[.06,.201],"lineTo",[.238,.381],"lineTo",[.272,.399],"lineTo",[.304,.382],"lineTo",[.304,.381],"lineTo",[.379,.302],"bezierCurveTo",[.394,.287,.398,.271,.391,.255],"lineTo",[.377,.233],"lineTo",[.199,.061],"lineTo",[.193,.049],"bezierCurveTo",[.19,.042,.191,.037,.194,.033],"bezierCurveTo",[.196,.028,.2,.024,.205,.022],"bezierCurveTo",[.219,.015,.232,.009,.244,.005],"lineTo",[.246,.005],"lineTo",[.394,0],"bezierCurveTo",[.459,.012,.515,.042,.564,.093],"lineTo",[.563,.093]]},GEAR:{color:"#FFFFFF",cmds:["moveTo",[.963,.306],"bezierCurveTo",[.988,.366,1,.43,1,.5],"bezierCurveTo",[1,.51,.996,.519,.989,.527],"bezierCurveTo",[.982,.534,.973,.538,.963,.538],"lineTo",[.859,.538],"lineTo",[.847,.602],"lineTo",[.944,.642],"lineTo",[.964,.663],"bezierCurveTo",[.968,.672,.968,.681,.964,.691],"bezierCurveTo",[.94,.75,.903,.805,.853,.855],"lineTo",[.828,.864],"lineTo",[.802,.855],"lineTo",[.728,.781],"lineTo",[.673,.819],"lineTo",[.714,.914],"bezierCurveTo",[.718,.923,.718,.933,.714,.942],"lineTo",[.694,.963],"bezierCurveTo",[.634,.988,.57,1,.5,1],"bezierCurveTo",[.49,1,.481,.996,.473,.989],"bezierCurveTo",[.466,.982,.463,.973,.463,.963],"lineTo",[.463,.859],"lineTo",[.398,.848],"lineTo",[.359,.944],"lineTo",[.339,.964],"bezierCurveTo",[.33,.968,.32,.968,.311,.964],"bezierCurveTo",[.251,.94,.196,.904,.147,.855],"bezierCurveTo",[.14,.847,.136,.839,.136,.828],"bezierCurveTo",[.136,.818,.14,.809,.147,.802],"lineTo",[.22,.728],"lineTo",[.183,.673],"lineTo",[.086,.714],"bezierCurveTo",[.077,.718,.067,.718,.058,.714],"lineTo",[.038,.694],"bezierCurveTo",[.013,.634,0,.57,0,.5],"bezierCurveTo",[0,.49,.004,.481,.011,.473],"bezierCurveTo",[.018,.466,.027,.463,.038,.463],"lineTo",[.141,.463],"lineTo",[.153,.398],"lineTo",[.056,.359],"lineTo",[.036,.339],"bezierCurveTo",[.032,.33,.032,.32,.036,.311],"bezierCurveTo",[.06,.251,.097,.196,.147,.147],"bezierCurveTo",[.154,.14,.163,.136,.172,.136],"bezierCurveTo",[.182,.136,.191,.14,.198,.147],"lineTo",[.272,.22],"bezierCurveTo",[.29,.206,.308,.193,.327,.183],"lineTo",[.286,.086],"bezierCurveTo",[.282,.077,.282,.067,.286,.058],"bezierCurveTo",[.29,.048,.297,.042,.306,.038],"bezierCurveTo",[.366,.013,.43,0,.5,0],"bezierCurveTo",[.51,0,.519,.004,.527,.011],"bezierCurveTo",[.534,.018,.538,.027,.538,.038],"lineTo",[.538,.141],"lineTo",[.602,.153],"lineTo",[.642,.056],"bezierCurveTo",[.645,.047,.652,.04,.661,.036],"bezierCurveTo",[.67,.032,.68,.032,.691,.036],"bezierCurveTo",[.729,.052,.766,.073,.802,.1],"lineTo",[.853,.147],"bezierCurveTo",[.86,.154,.864,.163,.864,.173],"lineTo",[.853,.198],"lineTo",[.781,.272],"lineTo",[.817,.327],"lineTo",[.914,.286],"bezierCurveTo",[.923,.282,.933,.282,.942,.286],"lineTo",[.963,.306]]},KEY:{color:"#FF4136",cmds:["moveTo",[.867,.098],"bezierCurveTo",[.868,.119,.865,.137,.857,.153],"lineTo",[.982,.296],"bezierCurveTo",[1.006,.324,1.006,.352,.982,.38],"lineTo",[.954,.411],"lineTo",[.941,.42],"lineTo",[.929,.413],"lineTo",[.91,.391],"lineTo",[.844,.47],"lineTo",[.863,.49],"lineTo",[.867,.503],"lineTo",[.861,.518],"lineTo",[.835,.55],"bezierCurveTo",[.809,.579,.784,.579,.76,.55],"lineTo",[.635,.406],"lineTo",[.516,.547],"bezierCurveTo",[.54,.592,.557,.641,.566,.693],"lineTo",[.563,.695],"bezierCurveTo",[.578,.791,.559,.867,.505,.924],"bezierCurveTo",[.455,.987,.387,1.011,.303,.995],"bezierCurveTo",[.236,.982,.175,.946,.12,.889],"lineTo",[.109,.875],"bezierCurveTo",[.051,.811,.016,.738,.004,.657],"lineTo",[.004,.655],"bezierCurveTo",[-.001,.624,-.001,.595,.003,.57],"bezierCurveTo",[.006,.51,.026,.46,.063,.42],"bezierCurveTo",[.099,.377,.143,.354,.194,.348],"lineTo",[.266,.351],"lineTo",[.27,.351],"bezierCurveTo",[.313,.36,.354,.379,.392,.406],"lineTo",[.727,.021],"bezierCurveTo",[.74,.004,.759,-.003,.783,.001],"bezierCurveTo",[.805,.004,.824,.015,.839,.034],"lineTo",[.852,.048],"bezierCurveTo",[.862,.062,.867,.079,.867,.098]]},MUSICNOTE:{color:"#0074D9",cmds:["moveTo",[1,.906],"lineTo",[1,.419],"lineTo",[1,.408],"bezierCurveTo",[.993,.349,.968,.3,.926,.263],"lineTo",[.922,.263],"bezierCurveTo",[.878,.22,.825,.196,.765,.192],"lineTo",[.763,.192],"bezierCurveTo",[.7,.186,.647,.203,.606,.242],"bezierCurveTo",[.565,.276,.547,.322,.554,.38],"bezierCurveTo",[.56,.432,.584,.477,.628,.516],"bezierCurveTo",[.67,.553,.715,.574,.765,.58],"lineTo",[.815,.58],"lineTo",[.815,.742],"lineTo",[.444,.742],"lineTo",[.444,.193],"bezierCurveTo",[.447,.152,.422,.111,.368,.071],"lineTo",[.367,.066],"bezierCurveTo",[.322,.028,.271,.007,.213,.001],"lineTo",[.211,.001],"bezierCurveTo",[.147,-.004,.094,.011,.054,.048],"bezierCurveTo",[.012,.083,-.006,.129,.002,.184],"bezierCurveTo",[.007,.237,.031,.284,.074,.324],"lineTo",[.078,.326],"bezierCurveTo",[.118,.36,.163,.381,.211,.39],"lineTo",[.213,.39],"lineTo",[.296,.387],"lineTo",[.296,.903],"bezierCurveTo",[.294,.97,.324,1.002,.387,1],"lineTo",[.889,1],"bezierCurveTo",[.963,1,1,.969,1,.906]]},LOCK:{color:"#2ECC40",cmds:["moveTo",[.875,.895],"lineTo",[.875,.789],"lineTo",[.75,.789],"lineTo",[.75,.895],"lineTo",[.25,.895],"lineTo",[.25,.526],"lineTo",[1,.526],"lineTo",[1,.053],"bezierCurveTo",[1,.038,.994,.025,.981,.014],"bezierCurveTo",[.969,.005,.954,0,.938,0],"lineTo",[.063,0],"bezierCurveTo",[.045,0,.03,.005,.017,.014],"bezierCurveTo",[.006,.025,0,.038,0,.053],"lineTo",[0,.526],"lineTo",[.125,.526],"lineTo",[.125,.895],"bezierCurveTo",[.125,.924,.137,.948,.161,.968],"bezierCurveTo",[.186,.989,.216,1,.25,1],"lineTo",[.75,1],"bezierCurveTo",[.784,1,.814,.989,.838,.968],"bezierCurveTo",[.863,.947,.875,.923,.875,.895]]},HEART:{color:"#85144b",cmds:["moveTo",[.528,.903],"bezierCurveTo",[.58,.968,.644,1,.722,1],"bezierCurveTo",[.798,1,.864,.968,.919,.903],"lineTo",[.922,.903],"bezierCurveTo",[.974,.839,1,.764,1,.678],"bezierCurveTo",[1,.605,.982,.542,.944,.488],"lineTo",[.919,.453],"lineTo",[.539,.019],"lineTo",[.5,0],"bezierCurveTo",[.485,0,.472,.006,.461,.019],"lineTo",[.081,.453],"lineTo",[.056,.488],"bezierCurveTo",[.019,.542,0,.605,0,.678],"bezierCurveTo",[0,.764,.027,.839,.081,.903],"bezierCurveTo",[.136,.968,.202,1,.278,1],"bezierCurveTo",[.356,1,.42,.968,.472,.903],"lineTo",[.528,.903]]},HOUSE:{color:"#0074D9",cmds:["moveTo",[.375,0],"lineTo",[.188,0],"bezierCurveTo",[.17,0,.155,.006,.142,.017],"bezierCurveTo",[.131,.03,.125,.045,.125,.062],"lineTo",[.125,.375],"lineTo",[0,.375],"lineTo",[0,.5],"lineTo",[.5,1],"lineTo",[1,.5],"lineTo",[1,.375],"lineTo",[.875,.375],"lineTo",[.875,.062],"bezierCurveTo",[.875,.045,.869,.03,.856,.017],"bezierCurveTo",[.844,.006,.829,0,.813,0],"lineTo",[.625,0],"lineTo",[.625,.375],"lineTo",[.375,.375],"lineTo",[.375,0]]}};AFRAME.registerGeometry("extrudeShape",{schema:{icon:{default:"HEART"},extrudeDepth:{default:.15}},init(a){const b=f[a.icon].cmds,c=new THREE.Shape;for(let d=0;d<b.length;d+=2){const a=b[d],e=b[d+1];c[a].apply(c,e)}const d={depth:a.extrudeDepth,bevelEnabled:!0,bevelThickness:.05,bevelSize:.06};this.geometry=new THREE.ExtrudeGeometry(c,d)}}),AFRAME.registerShader("gradient",{schema:{color:{type:"color",is:"uniform"},bottomColor:{type:"color",is:"uniform",default:"#ffffff"},offset:{is:"uniform",default:33},exponent:{is:"uniform",default:.6},timeMsec:{type:"time",is:"uniform"}},raw:!1,vertexShader:`
varying vec3 vWorldPosition;

void main() {
  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
  vWorldPosition = worldPosition.xyz;
  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}
`,fragmentShader:`
uniform vec3 color;
uniform vec3 bottomColor;
uniform float offset;
uniform float exponent;

varying vec3 vWorldPosition;

void main() {
  float h = normalize( vWorldPosition + offset ).y;
  gl_FragColor = vec4( mix( bottomColor, color, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );
}
`}),AFRAME.registerComponent("float-to",{schema:{targetPosition:{type:"vec3"},targetScale:{type:"vec3"},speed:{type:"number"},active:{default:!1},eventName:{default:"float-completed"}},init(){this.targetPosition=new THREE.Vector3,this.totalDistance=0},update(){this.targetPosition.copy(this.data.targetPosition),this.totalDistance=this.el.object3D.position.distanceToSquared(this.data.targetPosition)},tick(){if(!this.data.active)return;const{speed:a,targetScale:b}=this.data,{targetPosition:c,totalDistance:d}=this,e=this.el.object3D.position.distanceToSquared(c);this.el.object3D.lookAt(c),this.el.object3D.translateZ(a),this.el.object3D.scale.lerp(b,(d-e)/d),e<=a&&(this.el.setAttribute("float-to","active",!1),this.el.emit(this.data.eventName,{el:this.el}))}}),AFRAME.registerComponent("orbit",{schema:{startTheta:{default:0},deltaTheta:{type:"number"},radius:{type:"number"},active:{default:!0},center:{type:"vec3"}},init(){this.theta=this.data.startTheta,this.cameraPosition=document.querySelector("#camera").getAttribute("position")},tick(){if(!this.data.active)return;const{center:a,deltaTheta:b,radius:c}=this.data,{position:d}=this.el.object3D,{theta:e,cameraPosition:f}=this,g=a.x+c*Math.cos(e),h=a.y+c*Math.sin(e);this.el.object3D.lookAt(f),this.theta+=b,d.set(g,d.y,h)}}),AFRAME.registerComponent("selectable",{schema:{active:{default:!0},isSelected:{default:!1},type:{default:"Toy"}},init:function(){this.system=this.el.sceneEl.systems.game,this.lastIndex=-1,["click","triggerdown"].forEach(a=>{this.el.addEventListener(a,this)})},update(){this.data.isSelected?this.el.emit("selected"):this.el.emit("unselected")},handleEvent(){this.data.active&&(this.system.setSelected(this.el),this.el.setAttribute("selectable","isSelected",!0))}});const g={MOVE_TO_TOYBOX:[["G#6",.5],["G6",.25],["F#6",.25],["F6",.5]],MOVE_TO_ORBIT:[["F6",.5],["F#6",.25],["G6",.25],["G#6",.5]],WIN:[["A5",.5],["C6",.5],["A5",.5],["C6",.5],["A5",.5],["C6",.5]]},h=[[["C5",1],["D5",1],["C5",1],["",2],["C5",1],["D5",1],["C5",1],["",2],["C5",1],["D5",1],["C5",1],["",2],["D5",.75],["E5",.5],["D5",.25],["E5",.25],["D5",.75],["C5",.5],["D5",.5],["C5",.5],["",1]]],i=[[["E4",.5],["G4",.5],["A4",.5],["C5",.5],["C5",.5],["C5",.5],["A4",.5],["C5",.5],["E4",.5],["G4",.5],["A4",.5],["C5",.5],["C5",.5],["C5",.5],["A4",.5],["C5",.5],["E4",.5],["G4",.5],["A4",.5],["C5",.5],["C5",.5],["C5",.5],["A4",.5],["C5",.5],["E4",.5],["G4",.5],["A4",.5],["C5",.5],["C5",.5],["C5",.5],["A4",.5],["C5",.5]],[["A2",.5],["A2",.5],["G2",.5],["G2",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["D3",.5],["A2",.5],["A2",.5],["G2",.5],["G2",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["D3",.5],["A2",.5],["A2",.5],["G2",.5],["G2",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["D3",.5],["A2",.5],["A2",.5],["G2",.5],["G2",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["C3",.5],["D3",.5]]],j=[[["C4",.6],["C3",1.2],["C4",.6],["G4",.7],["E3",1.2],["G4",.6],["A4",.6],["F3",1.2],["A4",.6],["G4",1.2],["E3",1.2],["F4",.6],["D3",1.2],["F4",.6],["E4",.6],["C3",1.2],["E4",.6],["D4",.6],["F3",.6],["D4",.6],["G3",.6],["C4",1.2],["E3",.6],["C3",.6],["G4",.6],["E3",1.2],["G4",.6],["F4",.6],["F3",1.2],["F4",.6],["E4",.6],["G3",1.2],["E4",.6],["D4",1.2],["G3",2],["G4",.6],["E3",1.2],["G4",.6],["F4",.6],["F3",1.2],["F4",.6],["E4",.6],["G3",1.2],["E4",.6],["D4",1.2],["G3",1.2],["C4",.6],["C3",1.2],["C4",.6],["G4",.6],["E3",1.2],["G4",.6],["A4",.6],["F3",1.2],["A4",.6],["G4",1.2],["E3",1.2],["F4",.6],["D3",1.2],["F4",.6],["E4",.6],["C3",1.2],["E4",.6],["D4",.6],["F3",.6],["D4",.6],["G3",.6],["C4",1.2],["C3",1.2]]],k=["at-orbit","at-toybox","paired"];AFRAME.registerComponent("toy",{schema:{key:{type:"string"}},init(){this.soundSystem=this.el.sceneEl.systems.sound,this.elToybox=null,this.orbitPosition=new THREE.Vector3},play(){k.forEach(a=>this.el.addEventListener(a,this))},pause(){k.forEach(a=>this.el.removeEventListener(a,this))},handleEvent(a){const{detail:b}=a;switch(a.type){case"paired":return this.moveToToybox(b.elToybox);case"at-toybox":return this.canPutToyInBox()?this.onMatchSucceed():this.onMatchFailed();case"at-orbit":return this.resumeOrbit();default:}return!1},moveToToybox(a){const b=this.el.getAttribute("position"),c=a.getAttribute("position");this.elToybox=a,this.orbitPosition.copy(b),this.moveTo({position:c,scale:{x:.25,y:.25,z:.25},eventName:"at-toybox"}),this.soundSystem.playEffect(g.MOVE_TO_TOYBOX)},moveToOrbit(){this.moveTo({position:this.orbitPosition,scale:{x:1,y:1,z:1},eventName:"at-orbit"}),this.soundSystem.playEffect(g.MOVE_TO_ORBIT)},resumeOrbit(){this.el.setAttribute("orbit","active",!0)},moveTo({position:a,scale:b,eventName:c}){this.el.setAttribute("orbit","active",!1),this.el.setAttribute("float-to",{targetPosition:a,targetScale:b,active:!0,eventName:c})},canPutToyInBox(){const{elToybox:a}=this,b=a.getAttribute("toybox").key;return b===this.data.key},onMatchSucceed(){const{elToybox:a}=this;a.emit("put-away",{toy:this.el})},onMatchFailed(){this.moveToOrbit()}});const l=["selected","unselected","put-away"];AFRAME.registerComponent("toybox",{schema:{key:{type:"string"},totalToys:{type:"int"},isFull:{default:!1}},init(){this.system=this.el.sceneEl.systems.game,this.soundSystem=this.el.sceneEl.systems.sound,this.elPlanes=this.el.querySelectorAll("a-plane"),this.putAwayCount=0,this.leftToPutAway=this.data.totalToys},play(){l.forEach(a=>this.el.addEventListener(a,this))},pause(){l.forEach(a=>this.el.removeEventListener(a,this))},handleEvent(a){const{leftToPutAway:b}=this;switch(a.type){case"selected":return 0!==b&&this.colorModel("#0074D9");case"unselected":return 0!==b&&this.colorModel("#DDDDDD");case"put-away":return this.putAway(a.detail.toy);default:}return!1},putAway(){this.putAwayCount+=1,this.leftToPutAway=this.data.totalToys-this.putAwayCount,0===this.leftToPutAway&&(this.colorModel("#2ECC40"),this.el.setAttribute("toybox","isFull",!0),this.system.toyboxFilled(this.el),this.soundSystem.playEffect(g.WIN))},colorModel(a){const{elPlanes:b}=this;b.forEach(b=>{b.setAttribute("material","color",a)})}}),AFRAME.registerComponent("timer",{schema:{active:{default:!0},isPlaying:{default:!1}},init:function(){this.system=this.el.sceneEl.systems.game,this.milliseconds=0},tick(b,c){if(this.data.active&&this.data.isPlaying){const b=0|this.milliseconds/1e3;this.milliseconds+=c;const d=0|this.milliseconds/1e3;b==d||this.el.setAttribute("text",{value:`${a(this.milliseconds)}`})}}}),AFRAME.registerComponent("info-gamestate",{schema:{isGameover:{default:!1},msgPlaying:{default:"Put BACK all the toys."},msgWon:{default:"Winner Winner!\nWas it luck, or Skill?"}},update(){this.data.isGameover?this.el.setAttribute("text","value",this.data.msgWon):this.el.setAttribute("text","value",this.data.msgPlaying)}});class m{constructor(a){var b=Math.PI;const c=f[a].color;this.scene=document.querySelector("a-scene"),this.el=document.createElement("a-entity"),this.el.setAttribute("position",`0 ${THREE.Math.randInt(2,4)} 0`),this.el.setAttribute("rotation","0 0 0"),this.el.setAttribute("float-to",{speed:.05}),this.el.setAttribute("toy",{key:a}),this.el.setAttribute("orbit",{radius:THREE.Math.randInt(3,6),startTheta:THREE.Math.randFloat(0,2*b),deltaTheta:(0===THREE.Math.randInt(0,1)?1:-1)*(2*b/Math.pow(10,THREE.Math.randFloat(2.6,3.5)))}),this.el.innerHTML=`<a-entity
      selectable
      geometry="primitive: extrudeShape; icon: ${a}"
      material="opacity: 1; shader: flat; color: ${c}"
      >
    </a-entity>`,this.scene.appendChild(this.el)}}const n=.25,o=.5,p=.5;class q{constructor(a){const{position:b,shape:c,totalToys:d}=a,e=f[c].color;this.scene=document.querySelector("a-scene"),this.el=document.createElement("a-entity"),this.el.setAttribute("position",b),this.el.setAttribute("toybox",{key:c,totalToys:d}),this.el.innerHTML=`
      <a-plane position="0 ${n/2} ${p/2}" rotation="0 0 0" height="${n}" width="${o}" material="side: double"></a-plane>
      <a-plane position="0 ${n/2} ${-p/2}" rotation="0 0 0" height="${n}" width="${o}" material="side: double"></a-plane>
      <a-plane position="${o/2} ${n/2} 0" rotation="0 90 0" height="${n}" width="${o}" material="side: double"></a-plane>
      <a-plane position="${-o/2} ${n/2} 0" rotation="0 90 0"   height="${n}" width="${o}" material="side: double"></a-plane>
      <a-plane position="0 0 0" rotation="-90 0 0" height="${p}" width="${o}"></a-plane>
      <a-entity selectable="type: Toybox" geometry="primitive: box; width: 1; height: 1; depth: 1" material="visible: false"></a-entity>
      <a-entity
        position="-${o/3} 0 ${p/2}"
        scale="0.25 0.25 0.25"
        geometry="primitive: extrudeShape; icon: ${c}"
        material="color: ${e}; shader: flat;"
        >
        </a-entity>
    `,this.scene.appendChild(this.el)}}const r=Object.keys(f),s=(a=r)=>a[THREE.Math.randInt(0,a.length-1)],t=3,u=5;AFRAME.registerSystem("game",{init(){this.state=Object.assign({},b(),{selectedToy:null,selectedToybox:null}),this.soundSystem=this.el.sceneEl.systems.sound,this.elTimer=document.querySelector("[timer]"),this.elInfoGamestate=document.querySelector("[info-gamestate]")},setSelected(a){const b=a.getAttribute("selectable").type,c=`selected${b}`,d=this.state[c];a!==d&&(this.state[c]&&this.state[c].setAttribute("selectable","isSelected",!1),this.state[c]=a,this.state.selectedToy&&this.state.selectedToybox&&(this.state.selectedToy.emit("paired",{elToybox:this.state.selectedToybox.closest("[toybox]")}),this.state.selectedToy.setAttribute("selectable","isSelected",!1),this.state.selectedToy=null,this.elTimer.setAttribute("timer","isPlaying",!0)))},toyboxFilled(){const a=this.state.toyboxes.every(a=>a.el.getAttribute("toybox").isFull);if(a){this.elTimer.setAttribute("timer","isPlaying",!1),this.elInfoGamestate.setAttribute("info-gamestate","isGameover",a);const b=this.el.sceneEl.systems.sound;b.replaceBackgroundMusic(i)}}});const v={C0:16.35,"C#0":17.32,Db0:17.32,D0:18.35,"D#0":19.45,Eb0:19.45,E0:20.6,F0:21.83,"F#0":23.12,Gb0:23.12,G0:24.5,"G#0":25.96,Ab0:25.96,A0:27.5,"A#0":29.14,Bb0:29.14,B0:30.87,C1:32.7,"C#1":34.65,Db1:34.65,D1:36.71,"D#1":38.89,Eb1:38.89,E1:41.2,F1:43.65,"F#1":46.25,Gb1:46.25,G1:49,"G#1":51.91,Ab1:51.91,A1:55,"A#1":58.27,Bb1:58.27,B1:61.74,C2:65.41,"C#2":69.3,Db2:69.3,D2:73.42,"D#2":77.78,Eb2:77.78,E2:82.41,F2:87.31,"F#2":92.5,Gb2:92.5,G2:98,"G#2":103.83,Ab2:103.83,A2:110,"A#2":116.54,Bb2:116.54,B2:123.47,C3:130.81,"C#3":138.59,Db3:138.59,D3:146.83,"D#3":155.56,Eb3:155.56,E3:164.81,F3:174.61,"F#3":185,Gb3:185,G3:196,"G#3":207.65,Ab3:207.65,A3:220,"A#3":233.08,Bb3:233.08,B3:246.94,C4:261.63,"C#4":277.18,Db4:277.18,D4:293.66,"D#4":311.13,Eb4:311.13,E4:329.63,F4:349.23,"F#4":369.99,Gb4:369.99,G4:392,"G#4":415.3,Ab4:415.3,A4:440,"A#4":466.16,Bb4:466.16,B4:493.88,C5:523.25,"C#5":554.37,Db5:554.37,D5:587.33,"D#5":622.25,Eb5:622.25,E5:659.26,F5:698.46,"F#5":739.99,Gb5:739.99,G5:783.99,"G#5":830.61,Ab5:830.61,A5:880,"A#5":932.33,Bb5:932.33,B5:987.77,C6:1046.5,"C#6":1108.73,Db6:1108.73,D6:1174.66,"D#6":1244.51,Eb6:1244.51,E6:1318.51,F6:1396.91,"F#6":1479.98,Gb6:1479.98,G6:1567.98,"G#6":1661.22,Ab6:1661.22,A6:1760,"A#6":1864.66,Bb6:1864.66,B6:1975.53,C7:2093,"C#7":2217.46,Db7:2217.46,D7:2349.32,"D#7":2489.02,Eb7:2489.02,E7:2637.02,F7:2793.83,"F#7":2959.96,Gb7:2959.96,G7:3135.96,"G#7":3322.44,Ab7:3322.44,A7:3520,"A#7":3729.31,Bb7:3729.31,B7:3951.07,C8:4186.01,"C#8":4435,D8:4699,Eb8:4978,E8:5274,F8:5588,"F#8":5920,G8:6272,"G#8":6645,A8:7040,Bb8:7040,B8:7902};AFRAME.registerSystem("sound",{init(){this.audioContext=null,this.queuedNotes=[],document.monetization&&"started"===document.monetization.state?this.replaceBackgroundMusic(j):this.replaceBackgroundMusic(h),this.sceneEl.addEventListener("enter-vr",this),this.sceneEl.addEventListener("exit-vr",this),window.addEventListener("click",this)},tick(){if(!this.audioContext)return;const{queuedNotes:a}=this,{currentTime:b}=this.audioContext,e=a.filter(a=>{const c=b-a.startTime;return c>a.duration});e.forEach(a=>{const{noteName:b,duration:e}=a,f=c(b);d(this.audioContext,f,e)}),e.forEach(c=>{const{done:d,value:e}=c.noteIter.next();if(d){const b=a.indexOf(c);return void this.queuedNotes.splice(b,1)}const[f,g]=e;c.startTime=b,c.duration=g,c.noteName=f})},handleEvent(a){switch(a.type){case"click":case"enter-vr":window.removeEventListener("click",this),this.createAudioContext();break;case"exit-vr":this.dispose();break;default:}},playEffect(a,b=!1,c=""){const d=e(a,b),{value:[f,g]}=d.next();this.queuedNotes.push({startTime:-1,duration:g,noteName:f,noteIter:d,effectName:c})},replaceBackgroundMusic(a){const b="background-music";this.queuedNotes=this.queuedNotes.filter(a=>a.effectName!==b),a.forEach(a=>{this.playEffect(a,!0,b)})},createAudioContext(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext))},dispose(){this.audioContext&&(this.audioContext.close(),this.audioContext=null)}})})();</script><body><a-scene><a-entity id=player position="-0.20 0 0.5"><a-entity id=camera position="0 1.6 0" camera look-controls></a-entity><a-entity id=mouseHand raycaster="objects: [selectable]" cursor="rayOrigin: mouse"></a-entity><a-entity id=controllerHand raycaster="objects: [selectable]" laser-controls="model: false" line="color: #FF4136; opacity: 0.75;"></a-entity></a-entity><a-entity id=billboard position="0 0 -3"><a-cylinder color=#DDD height=3 position="-1 0 0" radius=0.025></a-cylinder><a-plane color=#AAA height=1 rotation="0 0 0" width=2 position="0 1.2 0"><a-entity position="0 0.25 0" text="color: #000; align: center; width: 4;" info-gamestate></a-entity><a-entity position="0 -0.3 0" text="value: 00:00; color: #000; align: center; width: 4;" timer></a-entity></a-plane><a-cylinder color=#DDD height=3 position="1 0 0" radius=0.025></a-cylinder></a-entity><a-sky material="shader: gradient; color: #0074D9; bottomColor: #FFF;"></a-sky><a-plane color=#3D9970 height=100 rotation="-90 0 0" width=100></a-plane></a-scene>